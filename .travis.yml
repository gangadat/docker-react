language: generic
# tell travis that we need superuser permission to execute
# this build.  Required for docker
sudo: required
services:
  # tell travis that we need docker installed
  - docker

# setup required before running tests or deploying software
before_install:
  # create a tag for the image so we can refer to it by name
  # instead of random generated ID
  # Convention for tag: "Docker Username/Repository Name"
  - docker build -t charlienlouie/docker-react -f Dockerfile.dev .

# command needed to run our test suite
script:
  - docker run -e CI=true charlienlouie/docker-react npm run test

deploy:
  # travis-ci comes preconfigured to talk to elastic beanstalk
  provider: elasticbeanstalk
  # http://docker-env.eba-gkcmrpkx.us-west-1.elasticbeanstalk.com/
  region: "us-west-1"
  # name of application in elastick beanstalk
  app: "docker"
  env: "Docker-env"
  # get the name of the s3 bucket generated by elasticbeanstalk
  bucket_name: "elasticbeanstalk-us-west-1-106687455341"
  # by default bucket_path is the app name and created with first deployment
  bucket_path: "docker"
  # whenever we push to master, then, that's when we deploy
  on:
    branch: master
  # get access key from AWS programmatic user that was created in IAM
  access_key_id: $AWS_ACCESS_KEY
  secret_access_key:
    secure: "$AWS_SECRET_KEY"
